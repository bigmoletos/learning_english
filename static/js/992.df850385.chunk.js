"use strict";(self.webpackChunkai_english_trainer_it=self.webpackChunkai_english_trainer_it||[]).push([[992],{1992:(e,t,a)=>{a.d(t,{getUserAssessmentStatus:()=>j,getUserById:()=>U,markAssessmentCompleted:()=>k});var r=a(2555),n=a(6667),o=a(7064),s=a(8557),c=a(6068);const i={apiKey:"AIzaSyA4VxXsU3yI3GedYREVkUIOgHo8NU1DUsw",authDomain:"ia-project-91c03.firebaseapp.com",projectId:"ia-project-91c03",storageBucket:"ia-project-91c03.firebasestorage.app",messagingSenderId:"764765123671",appId:"1:764765123671:web:c6861709d1a881fcfe1f12",measurementId:""};var l;const d="undefined"!==typeof window.Capacitor,u=d?null===(l=window.Capacitor)||void 0===l?void 0:l.getPlatform():"web";let v=null,f=null,m=null,p=null;try{v=(0,o.Wp)(i),f=(0,n.aU)(v),m=(0,s.xI)(v),p=(0,c.c7)(v),console.log("\u2705 Firebase initialis\xe9 avec succ\xe8s (".concat(u,")"))}catch(D){const e=D instanceof Error?D.message:String(D);console.error("\u274c Erreur Firebase (".concat(u,"):"),e),d&&console.warn("Mode offline activ\xe9 pour Capacitor")}var y=a(3110);const w=()=>!!m&&!!m.currentUser,g=e=>{if(!e)return null;const t=(0,r.A)({},e);return Object.keys(t).forEach(e=>{t[e]&&"object"===typeof t[e]&&"function"===typeof t[e].toDate?t[e]=t[e].toDate():t[e]&&"object"===typeof t[e]&&!Array.isArray(t[e])&&(t[e]=g(t[e]))}),t},h=async(e,t)=>{if(!f)return y.v.warn("Firestore n'est pas initialis\xe9"),null;try{const a=(0,n.H9)(f,e,t),o=await(0,n.x7)(a);if(o.exists()){const e=o.data();return g((0,r.A)((0,r.A)({},e),{},{id:o.id}))}return null}catch(D){var a,o,s,c;if("unavailable"===D.code||"failed-precondition"===D.code||"permission-denied"===D.code||"unauthenticated"===D.code||null!==(a=D.message)&&void 0!==a&&a.includes("offline")||null!==(o=D.message)&&void 0!==o&&o.includes("network")||null!==(s=D.message)&&void 0!==s&&s.includes("permission")||null!==(c=D.message)&&void 0!==c&&c.includes("authenticated"))return y.v.debug("Client offline ou non authentifi\xe9 lors de getDocument",{collection:e,documentId:t,errorCode:D.code}),null;throw y.v.error("Erreur lors de la r\xe9cup\xe9ration du document ".concat(e,"/").concat(t),D),D}},A="users",b=e=>({id:e.id,name:e.email||"".concat(e.firstName||""," ").concat(e.lastName||"").trim()||"Utilisateur",currentLevel:e.currentLevel,targetLevel:e.targetLevel,strengths:[],weaknesses:e.weaknesses||[],completedExercises:e.completedExercises||0,totalScore:e.totalScore||0,createdAt:e.createdAt,lastActivity:e.lastActivity||e.updatedAt}),U=async e=>{const t=await h(A,e);return t?b(t):null},j=async e=>{const t=await h(A,e);return(null===t||void 0===t?void 0:t.levelAssessed)||!1},k=async(e,t)=>{const a={levelAssessed:!0,assessmentCompletedAt:new Date};t&&(a.currentLevel=t),await(async(e,t,a)=>{if(f){if(!w()||!m||!m.currentUser)throw new Error("Utilisateur non authentifi\xe9. Impossible de mettre \xe0 jour dans Firestore.");try{var o;y.v.debug("Pr\xe9paration mise \xe0 jour: ".concat(e,"/").concat(t),{authUid:null===m||void 0===m||null===(o=m.currentUser)||void 0===o?void 0:o.uid,dataKeys:Object.keys(a||{}),dataSize:JSON.stringify(a).length});const s=(0,n.H9)(f,e,t),c=(0,r.A)({},a);let i=0;Object.keys(c).forEach(e=>{if(c[e]instanceof Date)c[e]=n.Dc.fromDate(c[e]),i++;else if(c[e]&&"string"===typeof c[e]&&c[e].match(/^\d{4}-\d{2}-\d{2}T/))try{c[e]=n.Dc.fromDate(new Date(c[e])),i++}catch(t){y.v.warn("Impossible de convertir la date pour ".concat(e),{value:c[e]})}}),i>0&&y.v.debug("".concat(i," date(s) convertie(s)")),await(0,n.mZ)(s,(0,r.A)((0,r.A)({},c),{},{updatedAt:n.Dc.now()})),y.v.info("Document mis \xe0 jour avec succ\xe8s: ".concat(e,"/").concat(t))}catch(D){var s;throw y.v.error("Erreur lors de la mise \xe0 jour du document ".concat(e,"/").concat(t),D,{code:D.code,collection:e,documentId:t,authUid:(null===(s=m.currentUser)||void 0===s?void 0:s.uid)||"non authentifi\xe9",dataKeys:Object.keys(a||{})}),D}}else y.v.warn("Firestore n'est pas initialis\xe9")})(A,e,a)}}}]);
//# sourceMappingURL=992.df850385.chunk.js.map